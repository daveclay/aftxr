
<html>
<head>
    <meta name="viewport"
          content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <link rel="shortcut icon" href="icon.ico">
    <link href='http://fonts.googleapis.com/css?family=Abel|Roboto+Condensed' rel='stylesheet' type='text/css'>
    <!-- <link href='http://fonts.googleapis.com/css?family=Ropa+Sans|Metrophobic|Allerta+Stencil' rel='stylesheet' type='text/css'> -->
    <link rel="stylesheet" type="text/css" href="css/aftxr.css"/>
</head>
<body>
<div id="logo">aftxr.com</div>
<div id="stage"></div>
<div id="progress"><div id="meter"></div></div>
<div id="data"></div>
<div id="interact"></div>
<div id="info"></div>

<script type="text/javascript">

    var bits = 125;
    var counter = 0;
    var origin = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
    var logo = document.getElementById("logo");
    var stage = document.getElementById("stage");
    var data = document.getElementById("data");
    var info = document.getElementById("info");
    var interact = document.getElementById("interact");
    var interactTimeout = null;
    var progress = document.getElementById("progress");
    var meter = document.getElementById("meter");
    var availableLines = [];
    var genes = [];

    function mutate() {
        setTimeout(function() {
            moveAll();
            mutate();
        }, Math.round(Math.random() * 2000) + 2000);
    }

    function moveAll() {
        var imgs = document.getElementsByTagName("img");
        for (var i = 0; i < imgs.length; i++) {
            var img = imgs[i];
            if (img.className == 'bit') {
                mutateComponent(img);
            }
        }
    }

    var c = 0;

    function flicker(el) {
        setTimeout(function() {
            el.style.display = Math.random() > .45 ? "block" : "none";
            c++;
            if (c > 100) {
                c = 0;
                el.style.display = "block";
            } else {
                flicker(el);
            }
        }, 30);
    }

    function identifyComponent(gene, line, x, y, length, angle) {
        gene.style.transform = "translate3d(5px, " + (y - 6) + "px, 0)";
        gene.style.opacity = .85;
        if (Math.random() > .1) {
            gene.className = "gene";
            gene.innerText = "MXCH" + Math.round(Math.random() * 10) + "NE.GENE+" + Math.round(Math.random() * 300);
        } else {
            gene.className = "gene genetic-error";
            gene.innerText = "ERROR/" + Math.round(Math.random() * 10) + ".V!RUS+" + Math.round(Math.random() * 30);
            flicker(gene);
        }

        line.style.transformOrigin = x + "px " + y + "px";
        line.style.transform = "rotate(" + angle + "deg) translate3d(" + x + "px, " + y + "px, 0)";
        line.style.width = length + "px";
        line.style.opacity = 1;
    }

    function mutateComponent(img) {

        var entityLocation = {
            y: function() {
                var range = window.innerHeight / 4;
                var amount = range / 2 - Math.round(Math.random() * range);
                return origin.y + amount - 80;
            },
            x: function() {
                var range = window.innerWidth / 3;
                var amount = range / 2 - Math.round(Math.random() * range);
                return origin.x + amount;
            }
        };

        setTimeout(function() {
            var scale = (Math.round(Math.random() * 70) + 30) / 100;
            var rotate = Math.round(Math.random() * 180);
            var opacity = (Math.round(Math.random() * 95) + 5) / 100;
            var x = entityLocation.x();
            var y = entityLocation.y();
            img.style.transformOrigin = x + "px " + y + "px";
            img.style.transform = "rotate(" + rotate + "deg) scale(" + scale + ") translate3d(" + x + "px, " + y + "px, 0)";
            img.style.opacity = opacity;
            img.style.zIndex = Math.round(Math.random() * 100);

            if (Math.random() < .02 && availableLines.length > 0) {
                var line = availableLines.pop();
                var gene = genes.pop();
                setTimeout(function() {
                    var px = 100;
                    var py = Math.round(Math.random() * (window.innerHeight - 100)) + 50;
                    var dx = x - px;
                    var dy = y - py;
                    var length = Math.sqrt(Math.pow(dx, 2) + Math.pow(dy, 2));
                    var radians = Math.atan2(dy, dx);
                    var angle = radians * (180 / Math.PI);
                    console.log(angle, length);
                    identifyComponent(gene, line, px, py, length, angle);
                    setTimeout(function() {
                        line.style.opacity = 0;
                        gene.style.opacity = 0;
                        availableLines.push(line);
                        genes.push(gene);
                    }, 3000);
                }, 400);
            }

        }, Math.round(Math.random() * 500));
    }

    function updateProgress() {
        counter++;
        var percent = Math.round(counter / bits * 100) + "%";
        meter.style.width = percent;
        info.innerText = percent;
        if (percent === "100%") {
            meter.style.display = "none";
            progress.style.display = "none";
            info.style.display = "none";
        }
    }

    function setOrigin() {
        if (interactTimeout) {
            clearTimeout(interactTimeout);
        }
        interact.style.transform = "translate3d(" + origin.x + "px, " + origin.y + "px, 0)";
        interact.style.opacity = .6;
        interact.innerText = "[" + origin.x + "," + origin.y + "]";
        interactTimeout = setTimeout(function() {
            interact.style.opacity = 0;
        }, 2000);
    }

    function initialize() {
        for (var i = 1; i <= bits; i++) {
            var img = document.createElement("img");
            img.src = "images/orig-bits/"+ i + ".png";
            img.className = "bit";
            img.onload = function() {
                updateProgress();
            };
            stage.appendChild(img);
        }

        for (var i = 0; i < 3; i++) {
            var line = document.createElement("div");
            line.className = "line";
            data.appendChild(line);
            availableLines.push(line);

            var gene = document.createElement("div");
            gene.className = "gene";
            data.appendChild(gene);
            genes.push(gene);
        }
    }

    initialize();
    moveAll();
    mutate();

    document.addEventListener("click", function(event) {
        origin = {
            x: event.pageX,
            y: event.pageY
        };
        setOrigin();
    });

    setInterval(function() {
        logo.innerText = "aftxr.+" + Math.round(Math.random() * 100000);
    }, 100);
</script>
</body>
</html>
